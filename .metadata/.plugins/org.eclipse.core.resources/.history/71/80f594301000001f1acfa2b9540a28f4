#include <stdint.h>
#include "stm32f1xx.h"

void configureLED(void);
void SysTick_Handler(void);
void delay_ms(uint32_t ms);

volatile uint32_t Tick;

int main(void)
{
	configureLED();

	SysTick_Config(8000); // 1ms (8MHz/1000ms)


	while(true)
	{
		GPIOC->BSRR |= GPIO_BSRR_BR13; /* '0' on GPIO13 */
		delay_ms(1000);
		GPIOC->BSRR |= GPIO_BSRR_BS13; /* '1' on GPIO13 */
		delay_ms(1000);
	}
}



void configureLED(void)
{
	/* LED is connected to PC13 on the APB2 bus */

	RCC->APB2ENR |= RCC_APB2ENR_IOPCEN; /* I/O port C clock enable */

	GPIOC->CRH |= GPIO_CRH_MODE13_0; /* Output mode, max speed 10 MHz */
	GPIOC->CRH &= ~(GPIO_CRH_MODE13_1);

	GPIOC->CRH &= ~(GPIO_CRH_CNF13); /* General purpose output push-pull */
}

void SysTick_Handler(void)
{
	Tick++;
}

void delay_ms(uint32_t ms)
{
	uint32_t StartTime = Tick;

	while(Tick < (StartTime + ms))
	{
		//do nothing
	}
}
